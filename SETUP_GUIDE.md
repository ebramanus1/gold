# دليل إعداد نظام إدارة ورشة الذهب للشبكة المحلية

## نظرة عامة
تم تعديل نظام إدارة ورشة الذهب ليعمل في بيئة محلية بالكامل مع دعم الشبكة المحلية، حيث يعمل الكمبيوتر الرئيسي كخادم قاعدة بيانات مركزي لجميع الأجهزة المتصلة بنفس الشبكة المحلية.

## المتطلبات الأساسية

### متطلبات الأجهزة
- كمبيوتر رئيسي (خادم) بمواصفات:
  - معالج: Intel Core i5 أو أعلى
  - ذاكرة: 8 جيجابايت RAM أو أكثر
  - مساحة تخزين: 500 جيجابايت أو أكثر
  - شبكة: منفذ Ethernet أو WiFi
- أجهزة عميلة (محطات العمل)
- راوتر أو سويتش للشبكة المحلية
- موازين رقمية (اختياري)
- ماسحات باركود (اختياري)
- طابعات (اختياري)

### متطلبات البرمجيات
- نظام التشغيل: Windows 10/11، macOS، أو Linux
- Flutter SDK 3.2.6 أو أحدث
- PostgreSQL 13 أو أحدث (للخادم الرئيسي)
- Dart SDK

## إعداد الخادم الرئيسي

### 1. تثبيت PostgreSQL

#### على Windows:
1. تحميل PostgreSQL من الموقع الرسمي
2. تشغيل ملف التثبيت واتباع التعليمات
3. تعيين كلمة مرور للمستخدم postgres
4. تأكد من تشغيل الخدمة على المنفذ 5432

#### على macOS:
```bash
# باستخدام Homebrew
brew install postgresql
brew services start postgresql

# إنشاء مستخدم قاعدة البيانات
createuser -s postgres
```

#### على Linux (Ubuntu/Debian):
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib

# بدء الخدمة
sudo systemctl start postgresql
sudo systemctl enable postgresql

# إنشاء مستخدم قاعدة البيانات
sudo -u postgres createuser --interactive
```

### 2. إعداد قاعدة البيانات

```sql
-- الاتصال بـ PostgreSQL
psql -U postgres

-- إنشاء قاعدة البيانات
CREATE DATABASE gold_workshop_db;

-- إنشاء مستخدم للتطبيق
CREATE USER gold_user WITH PASSWORD 'gold_password';

-- منح الصلاحيات
GRANT ALL PRIVILEGES ON DATABASE gold_workshop_db TO gold_user;

-- الخروج
\q
```

### 3. تكوين PostgreSQL للشبكة المحلية

#### تحرير ملف postgresql.conf:
```bash
# العثور على ملف التكوين
sudo find /etc -name "postgresql.conf" 2>/dev/null
# أو
sudo find /var/lib -name "postgresql.conf" 2>/dev/null
```

تحرير الملف وتعديل السطر التالي:
```
listen_addresses = '*'  # السماح بالاتصالات من جميع العناوين
port = 5432            # المنفذ الافتراضي
```

#### تحرير ملف pg_hba.conf:
إضافة السطر التالي للسماح بالاتصالات من الشبكة المحلية:
```
host    all             all             192.168.1.0/24          md5
host    all             all             192.168.0.0/24          md5
host    all             all             10.0.0.0/8              md5
```

#### إعادة تشغيل PostgreSQL:
```bash
# على Linux
sudo systemctl restart postgresql

# على macOS
brew services restart postgresql

# على Windows
# إعادة تشغيل خدمة PostgreSQL من Services
```

### 4. تكوين جدار الحماية

#### على Windows:
1. فتح Windows Defender Firewall
2. اختيار "Allow an app through firewall"
3. إضافة PostgreSQL أو السماح بالمنفذ 5432

#### على macOS:
```bash
# السماح بالمنفذ 5432
sudo pfctl -f /etc/pf.conf
```

#### على Linux:
```bash
# باستخدام ufw
sudo ufw allow 5432/tcp

# باستخدام iptables
sudo iptables -A INPUT -p tcp --dport 5432 -j ACCEPT
```

## إعداد التطبيق

### 1. تثبيت Flutter
```bash
# تحميل Flutter SDK من الموقع الرسمي
# إضافة Flutter إلى PATH
export PATH="$PATH:`pwd`/flutter/bin"

# التحقق من التثبيت
flutter doctor
```

### 2. إعداد المشروع
```bash
# الانتقال إلى مجلد المشروع
cd GoldWorkshop_AI_Modified

# تحديث المكتبات
flutter pub get

# تشغيل code generation
flutter packages pub run build_runner build
```

### 3. تكوين الاتصال بقاعدة البيانات

عند تشغيل التطبيق لأول مرة:
1. الانتقال إلى شاشة الإعدادات
2. اختيار "إعدادات الشبكة المحلية"
3. إدخال معلومات الخادم:
   - عنوان الخادم: عنوان IP للكمبيوتر الرئيسي
   - منفذ الخادم: 5432
   - اسم قاعدة البيانات: gold_workshop_db
   - اسم المستخدم: gold_user
   - كلمة المرور: gold_password

## إعداد الأجهزة العميلة

### 1. تثبيت التطبيق
```bash
# نسخ ملفات التطبيق إلى الجهاز العميل
# تثبيت Flutter (إذا لم يكن مثبتاً)
# تشغيل التطبيق
flutter run
```

### 2. تكوين الاتصال
1. فتح التطبيق على الجهاز العميل
2. الانتقال إلى إعدادات الشبكة
3. استخدام ميزة "اكتشاف الخوادم" للعثور على الخادم تلقائياً
4. أو إدخال عنوان IP للخادم يدوياً
5. اختبار الاتصال والحفظ

## إعداد الأجهزة الطرفية

### 1. الموازين الرقمية
- توصيل الميزان بالكمبيوتر عبر USB أو RS232
- تثبيت تعريفات الجهاز
- تكوين إعدادات الاتصال في التطبيق

### 2. ماسحات الباركود
- توصيل الماسح بالكمبيوتر عبر USB
- تكوين الماسح للعمل في وضع HID أو Serial
- اختبار المسح في التطبيق

### 3. الطابعات
- توصيل الطابعة بالشبكة أو بالكمبيوتر مباشرة
- تثبيت تعريفات الطابعة
- تكوين إعدادات الطباعة في التطبيق

## الميزات الجديدة

### 1. العمل دون اتصال بالإنترنت
- جميع البيانات محفوظة محلياً
- لا حاجة لاتصال بالإنترنت للعمليات الأساسية
- مزامنة تلقائية عند توفر الاتصال بالخادم

### 2. اكتشاف الخوادم التلقائي
- البحث التلقائي عن الخوادم في الشبكة المحلية
- اختبار الاتصال قبل الحفظ
- إعدادات متقدمة للشبكة

### 3. مزامنة البيانات
- مزامنة تلقائية كل 5 دقائق
- مزامنة يدوية عند الطلب
- تسجيل العمليات للمزامنة اللاحقة

### 4. دعم الأجهزة المحلية
- قراءة الوزن من الموازين الرقمية
- مسح الباركود والـ QR Code
- طباعة الإيصالات والملصقات

## استكشاف الأخطاء

### مشاكل الاتصال بقاعدة البيانات
1. التأكد من تشغيل PostgreSQL
2. فحص إعدادات جدار الحماية
3. التحقق من عنوان IP والمنفذ
4. مراجعة ملفات تكوين PostgreSQL

### مشاكل الشبكة
1. التأكد من اتصال جميع الأجهزة بنفس الشبكة
2. فحص إعدادات الراوتر
3. اختبار الاتصال باستخدام ping
4. التحقق من إعدادات DHCP

### مشاكل الأجهزة الطرفية
1. التأكد من توصيل الأجهزة بشكل صحيح
2. تثبيت التعريفات المناسبة
3. فحص إعدادات المنافذ التسلسلية
4. اختبار الأجهزة خارج التطبيق

## الصيانة والنسخ الاحتياطي

### النسخ الاحتياطي لقاعدة البيانات
```bash
# إنشاء نسخة احتياطية
pg_dump -U gold_user -h localhost gold_workshop_db > backup.sql

# استعادة النسخة الاحتياطية
psql -U gold_user -h localhost gold_workshop_db < backup.sql
```

### تحديث التطبيق
1. نسخ احتياطية للبيانات
2. تحديث ملفات التطبيق
3. تشغيل migrations إذا لزم الأمر
4. اختبار النظام

## الأمان

### حماية قاعدة البيانات
- استخدام كلمات مرور قوية
- تشفير الاتصالات (SSL)
- تحديث PostgreSQL بانتظام
- مراقبة سجلات الوصول

### حماية الشبكة
- استخدام شبكة منفصلة للنظام
- تكوين جدار حماية مناسب
- مراقبة حركة البيانات
- تحديث أنظمة التشغيل

## الدعم الفني

للحصول على المساعدة:
1. مراجعة هذا الدليل
2. فحص ملفات السجل
3. التواصل مع فريق الدعم الفني

---

**ملاحظة**: هذا النظام مصمم للعمل في بيئة محلية آمنة. تأكد من اتباع أفضل الممارسات الأمنية عند النشر.

